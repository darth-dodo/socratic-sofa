# Pre-commit hooks for code cleanliness, security, and developer experience
# Install: pre-commit install
# Run manually: pre-commit run --all-files

default_language_version:
  python: python3

repos:
  # =============================================================================
  # CODE FORMATTING
  # =============================================================================

  # isort - Import sorting (runs before ruff-format)
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ["--profile=black", "--line-length=100"]

  # Note: Black is disabled in favor of ruff-format (faster, consistent)

  # =============================================================================
  # LINTING
  # =============================================================================

  # Ruff - Fast Python linter (replaces flake8, pylint, etc.)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        args: ["--fix", "--exit-non-zero-on-fix"]
      - id: ruff-format

  # =============================================================================
  # SECURITY SCANNING
  # =============================================================================

  # Bandit - Security linter for Python
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.0
    hooks:
      - id: bandit
        args: ["-r", "-ll", "-x", "tests,outputs"] # Only medium+ severity
        files: "^src/"
        additional_dependencies: ["bandit[toml]"]

  # detect-secrets - Prevent secrets from being committed
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ["--baseline", ".secrets.baseline"]
        exclude: 'uv\.lock|\.env\.example|docs/|DEPLOYMENT'

  # =============================================================================
  # BLOAT & DEAD CODE DETECTION
  # =============================================================================

  # Check for large files
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-added-large-files
        args: ["--maxkb=500"]
        exclude: 'uv\.lock'

  # Vulture - Find dead/unused Python code
  - repo: https://github.com/jendrikseipp/vulture
    rev: v2.14
    hooks:
      - id: vulture
        args: ["src/", "--min-confidence=90", "--exclude=tools/"]

  # =============================================================================
  # DEVELOPER EXPERIENCE
  # =============================================================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # Whitespace & formatting
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: mixed-line-ending
        args: ["--fix=lf"]

      # File validation
      - id: check-yaml
        args: ["--unsafe"] # Allow custom tags
      - id: check-json
      - id: check-toml
      - id: check-xml

      # Python checks
      - id: check-ast
      - id: debug-statements
      - id: check-docstring-first

      # Git hygiene
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: no-commit-to-branch
        args: ["--branch", "main", "--branch", "master"]

      # Misc
      - id: detect-private-key
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

  # Prettier - Format markdown, YAML, JSON
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types_or: [markdown, yaml, json]
        exclude: 'uv\.lock'

  # =============================================================================
  # TYPE CHECKING
  # =============================================================================

  # MyPy - Static type checking (optional, can be slow)
  # Disabled by default - run manually with `make typecheck`
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.13.0
  #   hooks:
  #     - id: mypy
  #       args: ['--ignore-missing-imports', '--no-strict-optional']
  #       additional_dependencies: ['types-PyYAML']
  #       exclude: 'tests/'

  # =============================================================================
  # COMMIT MESSAGE
  # =============================================================================

  # Conventional commits
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.6.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: ["--strict"]

# CI configuration
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks
  autofix_prs: true
  autoupdate_branch: ""
  autoupdate_commit_msg: "[pre-commit.ci] pre-commit autoupdate"
  autoupdate_schedule: weekly
  skip: [mypy] # Skip slow hooks in CI
  submodules: false
